/**
 * iphoneSlide - jQuery plugin
 * @version: 0.7 (2011/10/27)
 * @requires jQuery v1.4+
 * @author Hina, Cain Chen. hinablue [at] gmail [dot] com
 * @modified by: Adam Chow adamchow2326@yahoo.com.au
 * Examples and documentation at: http://jquery.hinablue.me/jqiphoneslide
 * 
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 **/(function(a){a.fn.iphoneSlide=function(b){var c={handler:null,pageHandler:null,slideHandler:null,direction:"horizontal",maxShiftPage:5,nextPageHandler:".nextPage",prevPageHandler:".prevPage",draglaunch:.5,friction:.325,sensitivity:20,extrashift:800,touchduring:800,easing:"swing",bounce:!0,pageshowfilter:!1,autoPlay:!1,cancelAutoPlayOnResize:!0,autoCreatePager:!1,pager:{pagerType:"dot",selectorName:".banner_pager",childrenOnClass:"on",slideToAnimated:!0},autoPlayTime:3e3,onShiftComplete:function(){}},d={},e={pluginWorkspace:"test",jqipslide2page:function(b,c){var d=a(this),e=a(this).data("workData"),g=a(this).data("options");if(!e.initIphoneSlide)return alert("Your target is not iPhone-Slide workspace."),!1;var b=b,h={},c=typeof c=="boolean"?c:!0,i=a(g.handler,d),j=g.pageshowfilter?i.children(g.pageHandler).filter("visible"):i.children(g.pageHandler),k={X:0,Y:0},l=d.width(),m=d.height(),n=j.eq(b-1);if(b<=0||b>e.totalPages)return!1;d.data("workData",a.extend({},e,{nowPage:b}));var h=f.slide_to_page.call(this,b);c?a(i).animate(h.after,300,a.easing[g.easing]!==undefined?g.easing:"swing",function(){f.slide_callback.call(this)}):(a(i).css(h.after),f.slide_callback.call(this))},jqipblank2page:function(b,c,d){var e=a(this),f=a(this).data("workData"),g=a(this).data("options"),b=a.isArray(b)?b:typeof b=="string"?[b]:[],c=typeof c=="boolean"?c:!1,d=typeof c=="function"?c:typeof d=="function"?d:function(){return!1};if(!f.initIphoneSlide||b.length<=0)return alert("Your target is not iPhone-Slide workspace."),!1;var h=b.length,i=a(g.handler,e),j=c?f.totalPages+1:f.nowPage,k=(g.pageshowfilter?i.children(g.pageHandler).filter("visible").eq(0):i.children(g.pageHandler)).eq(0);a.each(b,function(a,b){k.clone().removeAttr("style").html(b).appendTo(i),a===h-1&&e.iphoneSlide(g,d).jqipslide2page(j,!1)})},init:function(b,d){var e=a.extend({},c,b),d=typeof d=="function"?d:function(){return this};return f.options=e,f.callback=d,a(this).each(function(){var b=a(this),c=b.data("workData"),d=a(e.handler,b),g=a.extend({},{origX:0,origY:0,X:0,Y:0}),h,i,j=matrixRow=matrixColumn=0,k=__mouseStarted=__touchesDevice=!1,l=e.pageshowfilter?d.children(e.pageHandler).filter("visible"):d.children(e.pageHandler);if(b.children().length>1)return alert("The Selector("+b.attr("id")+")'s page handler can not be more than one element."),this;if(e.handler===null||typeof e.handler!="string")e.handler=".iphone-slide-page-handler",b.children(":first").addClass("iphone-slide-page-handler");if(a(e.handler,b).children().length==0)return alert("You have no page(s) context."),this;if(e.pageHandler===null||typeof e.pageHandler!="string"){switch(d.attr("tagName").toLowerCase()){case"ul":case"ol":e.pageHandler="li";break;default:e.pageHandler=d.children(":first").attr("tagName").toLowerCase()}b.undelegate(e.handler,".jqiphoneslide")}else b.undelegate(e.pageHandler,".jqiphoneslide");a(e.prevPageHandler).unbind("click.jqiphoneslide",n,!1),a(e.nextPageHandler).unbind("click.jqiphoneslide",m,!1),b.bind("slideComplete.jqiphoneslide",function(a){a.preventDefault(),o()});var m=function(c){var g=b.data("workData"),h=parseInt(g.nowPage),i=parseInt(g.totalPages);h++;if(h>i)h=i;else{__mouseStarted=!0;var j=f.slide_to_page.call(b,h,0);d.animate(j.after,300,e.bounce&&a.easing[e.easing]!==undefined?e.easing:"swing",function(){__mouseStarted=!1,b.trigger({type:"slideComplete"}),f.slide_callback.call(this)})}return b.data("workData",a.extend({},g,{nowPage:h})),o(),!0},n=function(c){var g=b.data("workData"),h=parseInt(g.nowPage),i=parseInt(g.totalPages);h--;if(h>0){__mouseStarted=!0;var j=f.slide_to_page.call(b,h,0);d.animate(j.after,300,e.bounce&&a.easing[e.easing]!==undefined?e.easing:"swing",function(){__mouseStarted=!1,b.trigger({type:"slideComplete",nowPage:h}),f.slide_callback.call(this)})}else h=1;return b.data("workData",a.extend({},g,{nowPage:h})),!0},o=function(){var c=b.data("workData"),d=f.options||b.data("options"),e=a(d.handler,b);if(b.data("isPagerSet")===!0){var g=parseInt(c.nowPage)-1,h=a(d.pager.selectorName);a("li",h).removeClass(d.pager.childrenOnClass).eq(g).addClass(d.pager.childrenOnClass)}},p=function(){var c=b.data("workData"),d=parseInt(c.totalPages),f,g="",h;switch(e.pager.pagerType){case"number":h=0;break;case"dot":h="&#8226";break;default:h=""}for(var i=d;i>0;i--)g+="<li><span>"+(typeof h=="number"?d-i+1:h)+"</span></li>";e.pager.selectorName.charAt(0)==="."?f=a("<ul/>").addClass(e.pager.selectorName.substr(1,e.pager.selectorName.length-1)).html(g):e.pager.selectorName.charAt(0)==="#"?f=a("<ul/>").attr("id",e.pager.selectorName.substr(1,e.pager.selectorName.length-1)).html(g):f=a("<ul/>").html(g),b.data("isPagerSet",!0).parent().append(f),a("li",f).bind("click.pagerLink",function(c){b.data("workData").autoPlayTimer&&clearInterval(b.data("workData").autoPlayTimer),b.iphoneSlide("jqipslide2page",a(this).index()+1,e.pager.slideToAnimated),o()},!1),o()},q=function(c){b.data("workData").autoPlayTimer&&clearInterval(b.data("workData").autoPlayTimer);if(__mouseStarted)return!1;c.preventDefault(),__mouseStarted=!0;var f=c.originalEvent.touches||c.originalEvent.targetTouches||c.originalEvent.changedTouches,j=f===undefined?c:f[0];return h=i=a.extend({},j,{timeStamp:c.timeStamp}),f!==undefined&&(__touchesDevice=!0),g.origX=g.X=d.position().left,g.origY=g.Y=d.position().top,e.slideHandler===null||typeof e.slideHandler!="string"?f?b.delegate(e.handler,"touchmove.jqiphoneslide",r).delegate(e.handler,"touchend.jqiphoneslide touchcancel.jqiphoneslide MozTouchUp.jqiphoneslide",t):b.delegate(e.handler,"mousemove.jqiphoneslide",r).delegate(e.handler,"mouseleave.jqiphoneslide mouseup.jqiphoneslide",t):f?b.delegate(e.slideHandler,"touchmove.jqiphoneslide",r).delegate(e.slideHandler,"touchend.jqiphoneslide touchcancel.jqiphoneslide MozTouchUp.jqiphoneslide",t):b.delegate(e.slideHandler,"mousemove.jqiphoneslide",r).delegate(pts.slideHandler,"mouseleave.jqiphoneslide mouseup.jqiphoneslide",t),!__mouseStarted},r=function(b){if(a.browser.msie&&!b.button)return t(b);if(__mouseStarted){b.preventDefault();var c=b.originalEvent.touches||b.originalEvent.targetTouches||b.originalEvent.changedTouches,f=c===undefined?b:c[0],j=h;i=a.extend({},f,{timeStamp:b.timeStamp});switch(e.direction){case"matrix":g.X=parseInt(f.pageX-j.pageX),g.Y=parseInt(f.pageY-j.pageY),d.css({top:g.origY+g.Y+"px",left:g.origX+g.X+"px"});break;case"vertical":g.Y=parseInt(f.pageY-j.pageY),d.css({top:g.origY+g.Y+"px"});break;case"horizontal":default:g.X=parseInt(f.pageX-j.pageX),d.css({left:g.origX+g.X+"px"})}}return!__mouseStarted},s=function(a){return a.preventDefault(),k},t=function(c){c.preventDefault(),e.slideHandler===null||typeof e.slideHandler!="string"?b.undelegate(e.handler,"mousemove.jqiphoneslide touchmove.jqiphoneslide MozTouchMove.jqiphoneslide"):b.undelegate(e.slideHandler,"mousemove.jqiphoneslide touchmove.jqiphoneslide MozTouchMove.jqiphoneslide");var j=a(this).parent().data("workData"),m=parseInt(j.totalPages),n=parseInt(j.nowPage),o=parseInt(j.matrixRow),p=parseInt(j.matrixColumn),q,r=c.originalEvent.touches||c.originalEvent.targetTouches||c.originalEvent.changedTouches,s=h;r===undefined?q=__touchesDevice?i:c:q=r[0]===undefined?i:r[0],__mouseStarted&&(k=c.target==s.target);if(Math.max(Math.abs(s.pageX-q.pageX),Math.abs(s.pageY-q.pageY))<parseInt(e.sensitivity)){var E=a(c.target).parent("a").attr("href");d.css({top:g.origY,left:g.origX}),d.trigger("click.jqiphoneslide"),__mouseStarted=!1,f.goto_url(E)}else{k=!1;var u=Math.abs(i.timeStamp-h.timeStamp),v={width:b.outerWidth(),height:b.outerHeight()},w=l.eq(n-1),x={width:w.outerWidth(!0),height:w.outerHeight(!0)},y={X:f.get_moving_data.call(null,v.width,s.pageX,q.pageX,u),Y:f.get_moving_data.call(null,v.height,s.pageY,q.pageY,u)},z={X:0,Y:0,shift:Math.max(y.X.shift,y.Y.shift),speed:Math.max(y.X.speed,y.Y.speed)},A={X:Math.min(q.pageX-s.pageX,x.width),Y:Math.min(q.pageY-s.pageY,x.height)},B={X:Math.abs(g.X)<v.width*e.draglaunch&&Math.abs(g.Y)<v.height*e.draglaunch?u>e.touchduring?1:Math.ceil(y.X.speed*y.X.shift/x.width):0,Y:Math.abs(g.X)<v.width*e.draglaunch&&Math.abs(g.Y)<v.height*e.draglaunch?u>e.touchduring?1:Math.ceil(y.Y.speed*y.Y.shift/x.height):0};during=Math.min(300,e.touchduring,Math.max(1/z.speed*Math.abs(e.extrashift),Math.abs(e.extrashift)*.5));switch(e.direction){case"matrix":var C=Math.ceil(n/o);B.X=B.X>o?o:Math.abs(g.X)<x.width*e.draglaunch?Math.floor(Math.abs(A.Y/A.X))>2?0:B.X:1,B.X=A.X>0?Math.min(B.X,n-o*(C-1)-1):Math.min(B.X,o*C-n),B.Y=B.Y>p?p:Math.abs(g.Y)<x.height*e.draglaunch?Math.floor(Math.abs(A.X/A.Y))>2?0:B.Y:1,B.Y=A.Y>0?Math.min(B.Y,C-1):o*B.Y+n>m?p-C:B.Y,n=A.X>0?n-B.X<1?1:n-B.X:n+B.X>m?m:n+B.X,n=A.Y>0?n-B.Y*o<1?1:n-B.Y*o:B.Y*o>m?m:n+B.Y*o;break;case"vertical":B.X=0,B.Y=B.Y==0?1:B.Y>e.maxShiftPage?e.maxShiftPage:B.Y,B.Y=A.Y>0?n-B.Y<1?n-1:B.Y:n+B.Y>m?m-n:B.Y,n=A.Y>0?n-B.Y<1?1:n-B.Y:n+B.Y>m?m:n+B.Y;break;case"horizontal":default:B.Y=0,B.X=B.X==0?1:B.X>e.maxShiftPage?e.maxShiftPage:B.X,B.X=A.X>0?n-B.X<1?n-1:B.X:n+B.X>m?m-n:B.X,n=A.X>0?n-B.X<1?1:n-B.X:n+B.X>m?m:n+B.X}var D=e.bounce===!0?f.slide_to_page.call(this,n,A):f.slide_to_page.call(this,n,0);e.bounce===!0&&d.animate(D.before,during),d.animate(D.after,during,a.easing[e.easing]!==undefined?e.easing:"swing",function(){__mouseStarted=!1,b.trigger({type:"slideComplete",nowPage:n}),f.slide_callback.call(this)})}return e.slideHandler===null||typeof e.slideHandler!="string"?b.undelegate(e.handler,"mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide touchcancel.jqiphoneslide MozTouchUp.jqiphoneslide",t):b.undelegate(e.slideHandler,"mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide touchcancel.jqiphoneslide MozTouchUp.jqiphoneslide",t),b.data("workData",a.extend({},j,{nowPage:n})),!__mouseStarted};return e.slideHandler===null||typeof e.slideHandler!="string"?(d.delegate("a, button, input[type=button], input[type=reset], input[type=submit]","touchstart.jqiphoneslide click.jqiphoneslide",s),b.delegate(e.handler,"mousedown.jqiphoneslide touchstart.jqiphoneslide MozTouchDown.jqiphoneslide",q)):(d.filter(e.slideHandler).delegate("a, button, input[type=button], input[type=reset], input[type=submit]","touchstart.jqiphoneslide click.jqiphoneslide",s),b.delegate(e.slideHandler,"mousedown.jqiphoneslide touchstart.jqiphoneslide MozTouchDown.jqiphoneslide",q)),a(e.nextPageHandler).bind("click.jqiphoneslide",m,!1),a(e.prevPageHandler).bind("click.jqiphoneslide",n,!1),f.init_pages.call(this),e.autoPlay&&(b.data("workData").autoPlayTimer&&clearInterval(b.data("workData").autoPlayTimer),b.data("workData").autoPlayTimer=setInterval(function(){var a=b.data("workData"),c=parseInt(a.nowPage),d=parseInt(a.totalPages);c===d&&(a.nowPage=0),m()},e.autoPlayTime)),e.pager&&e.autoCreatePager&&!b.data("isPagerSet")&&p(),a(window).resize(function(){b.data("workData").autoPlayTimer&&e.cancelAutoPlayOnResize&&clearInterval(b.data("workData").autoPlayTimer)}),this})}},f={options:null,callback:function(){return this},logs:function(b){var c=new Date,d=a("#log");return d.html(c.toUTCString()+": "+b+"<br />"+d.html()),!0},get_moving_data:function(a,b,c,d){var e=0,g=0,a=a*1,b=b*1,c=c*1,d=d*1,h=f.options;return e=Math.abs(b-c)/Math.abs(d),g=Math.floor(Math.pow(e/12,2)*Math.abs(h.extrashift)/(2*(9.80665/12)*Math.abs(h.friction))*.01),g=b>a/2?Math.floor(a/3):b,{speed:e,shift:g}},init_pages:function(){var b,c=f.options,d=a(this),e=a(c.handler,d),g=c.pageshowfilter?e.children(c.pageHandler).filter(":visible"):e.children(c.pageHandler),h=matrixColumn=pagesOuterWidth=pagesOuterHeight=maxWidthPage=maxHeightPage=0,i=1;b=g.length,maxWidthPage=d.width(),maxHeightPage=d.height();switch(c.direction){case"matrix":h=Math.ceil(Math.sqrt(b)),matrixColumn=Math.ceil(b/h),g.each(function(b,c){maxWidthPage=a(c).outerWidth(!0)<maxWidthPage?maxWidthPage:a(c).outerWidth(!0),maxHeightPage=a(c).outerHeight(!0)<maxHeightPage?maxHeightPage:a(c).outerHeight(!0)}),pagesOuterWidth=maxWidthPage*h,pagesOuterHeight=maxHeightPage*matrixColumn,e.width(pagesOuterWidth).height(pagesOuterHeight),g.each(function(b,c){a(c).outerWidth()<maxWidthPage&&a(c).css({"margin-left":(maxWidthPage-a(c).outerWidth())/2,"margin-right":(maxWidthPage-a(c).outerWidth())/2}),a(c).outerHeight()<maxHeightPage&&a(c).css({"margin-top":(maxHeightPage-a(c).outerHeight())/2,"margin-bottom":(maxHeightPage-a(c).outerHeight())/2})});for(var j=matrixColumn;j>1;j--)a('<br class="matrix-break-point" style="clear:both;" />').insertAfter(g.eq((j-1)*h-1));break;case"vertical":g.each(function(b,c){pagesOuterHeight+=a(c).outerHeight(!0),maxWidthPage=a(c).outerWidth(!0)<maxWidthPage?maxWidthPage:a(c).outerWidth(!0),maxHeightPage=a(c).outerHeight(!0)<maxHeightPage?maxHeightPage:a(c).outerHeight(!0)}),g.each(function(b,c){a(c).outerWidth()<maxWidthPage&&a(c).css("margin-left",(maxWidthPage-a(c).outerWidth())/2)}),pagesOuterWidth=maxWidthPage,e.height(pagesOuterHeight).width(pagesOuterWidth).css("top",(maxHeightPage-g.eq(0).outerHeight(!0))/2);break;case"horizontal":default:g.each(function(b,c){pagesOuterWidth+=a(c).outerWidth(!0),maxWidthPage=a(c).outerWidth(!0)<maxWidthPage?maxWidthPage:a(c).outerWidth(!0),maxHeightPage=a(c).outerHeight(!0)<maxHeightPage?maxHeightPage:a(c).outerHeight(!0)}),g.each(function(b,c){a(c).outerHeight()<maxHeightPage&&a(c).css("margin-top",(maxHeightPage-a(c).outerHeight())/2)}),pagesOuterHeight=maxHeightPage,e.width(pagesOuterWidth).height(pagesOuterHeight).css("left",(maxWidthPage-g.eq(0).outerWidth(!0))/2)}g.css({display:"block"}),d.data("workData")&&(i=d.data("workData").nowPage),d.width(maxWidthPage).height(maxHeightPage).data("workData",a.extend({},{totalPages:b,matrixRow:h,matrixColumn:matrixColumn,pagesOuterWidth:pagesOuterWidth,pagesOuterHeight:pagesOuterHeight,nowPage:i,initIphoneSlide:!0,autoPlayTimer:null})).data("options",c),e.attr("data-target","handler"),f.callback.call(this)},slide_callback:function(){var b=a(this).attr("data-target")==="handler"?a(this).parent():a(this),c=b.data("workData"),d=c.nowPage,e=f.options||b.data("options"),g=a(e.handler,b).children(e.pageHandler);e.pageshowfilter?e.onShiftComplete.call(b,g.filter(":visible").eq(d-1),d):e.onShiftComplete.call(b,g.eq(d-1),d)},slide_to_page:function(b,c){var b=b,d=a(this).attr("data-target")==="handler"?a(this).parent():a(this),e=f.options||d.data("options"),g=a(e.handler,d),c=c||{X:0,Y:0},h=e.pageshowfilter?g.children(e.pageHandler).filter("visible"):g.children(e.pageHandler),i={X:0,Y:0},j={before:{},after:{}},k=d.width(),l=d.height(),m=h.eq(b-1);switch(e.direction){case"matrix":i.X=m.position().left,i.X-=(k-m.outerWidth(!0))/2,i.Y=m.position().top,i.Y-=(l-m.outerHeight(!0))/2,j={before:{top:-1*i.Y+c.Y,left:-1*i.X+c.X},after:{top:-1*i.Y,left:-1*i.X}};break;case"vertical":i.Y=m.position().top,i.Y-=(l-m.outerHeight(!0))/2,j={before:{top:-1*i.Y+c.Y},after:{top:-1*i.Y}};break;case"horizontal":default:i.X=m.position().left,i.X-=(k-m.outerWidth(!0))/2,j={before:{left:-1*i.X+c.X},after:{left:-1*i.X}}}return j},goto_url:function(a){a&&(window.location.href=a)}};if(e[b]&&b.toLowerCase()!="init")return e[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return e.init.apply(this,arguments);a.error('Method "'+b+'" does not exist in iPhoneSlide plugin!')}})(jQuery);